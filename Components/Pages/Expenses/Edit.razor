@page "/Expenses/Edit/{EntityId:guid}"
@using AccountingForDentists.Infrastructure
@using Microsoft.EntityFrameworkCore

@inject IDbContextFactory<AccountingContext> contextFactory

<div class="grow justify-items-center-safe">
    <h1 class="mt-4 mb-2">Edit Expense</h1>
    <form class="" @formname="edit" method="post" action="/Expenses/Post/Edit/@ExpenseEntity?.ExpensesId"
        enctype="multipart/form-data">
        <AntiforgeryToken />
        <fieldset class="fieldset min-w-sm max-w-lg rounded-box  p-4">
            <datalist id="sellers">
                @foreach (var seller in SellerNames ?? Enumerable.Empty<string>())
                {
                    <option value="@seller"></option>
                }
            </datalist>
            <label class="label">Invoice Date</label>
            <input class="input w-full" type="date" id="date" name="date"
                value="@ExpenseEntity?.DateReference?.Date.ToString("yyyy-MM-dd")" />
            <label class="label">Seller</label>
            <input class="input w-full" list="sellers" id="seller" name="seller" value="@ExpenseEntity?.BusinessName" />
            <label class="label">Description</label>
            <input class="input w-full" id="description" name="description" value="@ExpenseEntity?.Description" />
            <div class="flex gap-2 mt-2">
                <div class="w-28 grow-2">
                    <label class="label">Amount</label>
                    <input class="input" type="number" step="0.01" id="amount" name="amount" onchange="calculateTotal()"
                        value="@ExpenseEntity?.Amount.ToString("0.00")" />
                </div>
                <div class="w-24 grow">
                    <label class="label">GST</label>
                    <input class="input" type="number" step="0.01" id="gst" name="gst" onchange="calculateTotal()"
                        value="@ExpenseEntity?.GST.ToString("0.00")" />
                </div>
            </div>
            <label class="label">Total</label>
            <input class="input w-full" type="number" readonly step="0.01" id="total"
                value="@(((ExpenseEntity?.Amount + ExpenseEntity?.GST) ?? 0).ToString("0.00"))" />

            <label class="label mt-2">Add/Replace Attachment</label>
            <input type="file" class="file-input w-full" name="attachment" />
            @if (ExpenseEntity?.Attachment is null)
            {
                <p class="mt-2">No attachment uploaded.</p>
            }
            else
            {
                <p class="mt-2">Current Attachment: <a class="link" target="_blank"
                        href="/api/attachment/@ExpenseEntity?.Attachment?.AttachmentId">@ExpenseEntity?.Attachment?.CustomerFilename</a>
                </p>
                <label class="label peer mt-2">
                    <input type="checkbox" class="toggle peer" name="removeAttachment" value="true" />
                    <div class="peer-checked:text-black  peer-checked:font-bold">Remove attachment</div>
                </label>
            }

        </fieldset>

        <div class="flex gap-2  justify-center-safe">
            <input type="submit" disabled style="display: none" aria-hidden="true" />
            <button class="btn btn-neutral mt-4" tab type="submit">Save</button>
            <button class="btn btn-ghost mt-4" type="reset">Reset</button>
        </div>
    </form>
</div>

<script>
    function calculateTotal() {
        const amount = parseFloat(document.getElementById('amount').value) || 0;
        const gst = parseFloat(document.getElementById('gst').value) || 0;
        const total = amount + gst;
        document.getElementById('total').value = total.toFixed(2);
    }
</script>