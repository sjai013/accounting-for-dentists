@using AccountingForDentists.Components.Shared
@using AccountingForDentists.Models
<UndismissableModal Title="Confirm Delete" @ref="modal">

    <Body>
        Delete Contract Entry?
        <div class="fs-5">@pendingDelete?.BusinessName @@
            @pendingDelete?.DateReference.Date.ToString("dd/MM/yyyy")</div>
        <div class="fs-5">@pendingDelete?.Description</div>
        <div class="d-flex gap-2 fs-5">
            <div class=""> Amount: $@pendingDelete?.Amount.ToString("#,##0.00")</div>
        </div>



    </Body>
    <Footer>
        <button type="button" class="btn btn-outline-danger" disabled=@deleteInProgress
            @onclick="async () => await Delete()">
            @if (deleteInProgress)
            {
                <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                <span role="status">Deleting...</span>
            }
            else
            {
                <span>Delete</span>
            }
        </button>
        <button type="button" class="btn btn-outline-secondary" disabled=@deleteInProgress
            @onclick="() => modal.Close()">No</button>
    </Footer>
</UndismissableModal>

@code {
    UndismissableModal modal { get; set; } = null!;
    SalesEntity? pendingDelete { get; set; }
    bool deleteInProgress { get; set; }

    [Parameter]
    public EventCallback<SalesEntity> OnDeleteEntity { get; set; }

    public async Task ShowModal(SalesEntity? entity)
    {
        if (entity is null) return;
        deleteInProgress = false;
        pendingDelete = entity;
        await modal.Show();
        this.StateHasChanged();
    }

    public async Task Delete()
    {
        this.deleteInProgress = true;
        try
        {
            var waitTask = Task.Delay(250);
            await OnDeleteEntity.InvokeAsync(pendingDelete);
            await modal.Close();
        }
        finally
        {
            this.deleteInProgress = false;
        }
    }
}